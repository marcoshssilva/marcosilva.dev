kind: pipeline
spec:
  stages:
  - type: ci
    spec:
      volumes:
      - name: dockersock
        spec: {}
        type: temp
      steps:
      - name: docker-dind
        type: background
        spec:
          container:
            image: docker:dind
            privileged: true
          mount:
          - name: dockersock
            path: /var/run
      - name: 'download_dependencies'
        type: run
        spec:
          container: node:20
          script: |-
            npm install --force
      - name: 'run_tests'
        type: run
        spec:
          container: node:20
          script: |-
            npm run lint
            npm run test
      - name: 'run_build'
        type: run
        spec:
          container: node:20
          script: |-
            npm run build
      - name: 'generate_docker_image'
        type: run
        spec:
          container: docker:dind
          mount:
          - name: dockersock
            path: /var/run
          script: |-
            sleep 5
            docker build --tag marcosilva-dev-website:latest .
            docker images
